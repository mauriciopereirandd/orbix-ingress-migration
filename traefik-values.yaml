# traefik-values.yaml
image:
  tag: "v3.0"

# Configuração do deployment
deployment:
  enabled: true
  replicas: 2
  
# Porta diferente do Nginx para coexistência
ports:
  web:
    port: 8000
    exposedPort: 80
    protocol: TCP
  websecure:
    port: 8443
    exposedPort: 443
    protocol: TCP
    tls:
      enabled: true
  metrics:
    port: 9100
    expose: true
    protocol: TCP

# Habilitar Gateway API Provider
providers:
  kubernetesGateway:
    enabled: true
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: true

# Service configuration
service:
  enabled: true
  type: LoadBalancer
  # Usar annotations diferentes do Nginx
  annotations:
    service.beta.kubernetes.io/azure-load-balancer-internal: "false"
  # Usar um IP diferente ou deixar o cloud provider alocar
  # loadBalancerIP: "SEU_IP_AQUI"  # Comentar para auto-alocação

# Logs e Observabilidade
logs:
  general:
    level: INFO
  access:
    enabled: true

# Métricas Prometheus
metrics:
  prometheus:
    enabled: true
    entryPoint: metrics

# Dashboard (desabilitar em produção)
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.local.domain`)
    entryPoints: ["websecure"]

# Resource limits
resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "1000m"
    memory: "512Mi"

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Autoscaling
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      targetAverageUtilization: 70

# Security context
securityContext:
  capabilities:
    drop: [ALL]
  readOnlyRootFilesystem: true
  runAsGroup: 65532
  runAsNonRoot: true
  runAsUser: 65532

# GatewayClass configuration
gatewayClass:
  enabled: true
  name: traefik